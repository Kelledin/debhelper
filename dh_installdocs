#!/bin/sh -e
#
# Reads debian/docs, installs all files listed there into /usr/doc/$PACKAGE
# Also installs the debian/copyright and debian/README.debian and debian/TODO

PATH=debian:$PATH:/usr/lib/debhelper
. dh_lib

for PACKAGE in $DH_DOPACKAGES; do
	TMP=`tmpdir $PACKAGE`
	file=`pkgfile $PACKAGE docs`

	if [ ! -d $TMP/usr/doc/$PACKAGE ]; then
		doit "install -d $TMP/usr/doc/$PACKAGE"
	fi

	docs=""

	if [ "$file" ]; then
		docs=`tr "\n" " " < $file`
	fi

	if [ \( "$PACKAGE" = "$DH_FIRSTPACKAGE" -o "$DH_PARAMS_ALL" \) \
	     -a "$*" ]; then
		docs="$* $docs"
	fi

	if [ "$docs" ]; then
		doit "cp -a $docs $TMP/usr/doc/$PACKAGE/"
	fi

	# Install these files only into the main package by default.
	if [ "$PACKAGE" = "$MAINPACKAGE" ]; then
		if [ -f debian/README.debian ]; then
			# .Debian is correct according to policy.
			doit "install -m 644 -p debian/README.debian $TMP/usr/doc/$PACKAGE/README.Debian"
		fi
		if [ -f debian/README.Debian ]; then
			doit "install -m 644 -p debian/README.Debian $TMP/usr/doc/$PACKAGE/"
		fi
		if [ -f debian/TODO ]; then
			if isnative; then
				doit "install -m 655 -p debian/TODO $TMP/usr/doc/$PACKAGE/TODO"
			else
				doit "install -m 644 -p debian/TODO $TMP/usr/doc/$PACKAGE/TODO.Debian"
			fi
		fi
	fi

	# Support debian/package.copyright, but if not present, fall back
	# on debian/copyright for all packages, not just the main binary
	# package.
	copyright=`pkgfile $PACKAGE copyright`
	if [ ! "$copyright" -a -e debian/copyright ]; then
		copyright=debian/copyright
	fi
	if [ "$copyright" ]; then
			doit "install -m 644 -p $copyright $TMP/usr/doc/$PACKAGE/copyright"
	fi
done
